%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%% output control / counter and macro hell
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\usepackage{ifthen}
\newcounter{include_sshots}
\setcounter{include_sshots}{0}

\newcommand{\sshots}[1]{\ifthenelse{\equal{\value{include_sshots}}{0}}{}{#1}}
\newcommand{\sshot}[1]{\sshots{\begin{center}\includegraphics[scale=.7]{#1}\end{center}}}
\newcommand{\sshotm}[1]{\sshots{\begin{center}\includegraphics[scale=.5]{#1}\end{center}}}


\newcounter{make_cover}
\setcounter{make_cover}{0}

\newcounter{ver_major}
\newcounter{ver_minor}


\newcounter{include_windows}
\setcounter{include_windows}{0}
\newcounter{include_mac}
\setcounter{include_mac}{0}
\newcounter{include_linux}
\setcounter{include_linux}{0}
\newcounter{include_all}
\setcounter{include_all}{0}
\newcounter{mac_or_lin}
\newcounter{mac_and_lin}


\newcommand{\maclin}{
  \ifthenelse{\equal{\value{mac_and_lin}}{0}}{\ifthenelse{\equal{\value{include_mac}}{0}}{\ifthenelse{\equal{\value{include_linux}}{0}}{}{Linux}}{Mac}}{Linux and Mac}}

\newcommand{\incwin}[1]{\ifthenelse{\equal{\value{include_windows}}{1}}{#1}{}}
\newcommand{\incmaclin}[1]{\ifthenelse{\equal{\value{mac_or_lin}}{1}}{#1}{}}
\newcommand{\incall}[1]{\ifthenelse{\equal{\value{include_all}}{1}}{#1}{}}

\newcommand{\printversion}{\arabic{ver_major}.\arabic{ver_minor}}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%% definitions
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\makeatletter
\newcommand\code{\bgroup\@makeother\_\@makeother\~\@makeother\$\@codex}
\def\@codex#1{{\normalfont\ttfamily\hyphenchar\font=-1 #1}\egroup}
\makeatother
%%\let\code=\texttt
\let\proglang=\textsf

\newcommand{\pkg}[1]{{\fontseries{b}\selectfont #1}}

\newcommand{\bX}{\boldsymbol{X}}
\newcommand{\bx}{\boldsymbol{x}}
\newcommand{\by}{\boldsymbol{y}}
\newcommand{\bbeta}{\boldsymbol{\beta}}
\newcommand{\bepsilon}{\boldsymbol{\epsilon}}


\newcommand{\ltwo}[1]{\left|\left| #1 \right|\right|_2}
\newcommand{\norm}[1]{\left|\left| #1 \right|\right|}


\newcommand\mnote[1]{\marginpar{\vspace*{-.8cm}#1}}

\newcommand\easy{\mnote{\LARGE\color{green} \textbf{Easy}}}
\newcommand\medium{\mnote{\LARGE\color{yellow2} \textbf{Medium}}}
\newcommand\hard{\mnote{\LARGE\color{red} \textbf{Hard}}}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%% paragraph spacing
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\usepackage{parskip}
\setlength{\parskip}{.3cm}

\usepackage[utf8]{inputenc}
\usepackage[margin=0.75in]{geometry}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%% colors
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\usepackage{xcolor}
\usepackage{color}

\definecolor{yellow2}{rgb}{1, .7, 0}

\definecolor{mygreen}{RGB}{0,150,0}

\definecolor{gray}{rgb}{.6,.6,.6}
\definecolor{dkgray}{rgb}{.3,.3,.3}
\definecolor{orange}{rgb}{1,0.5,0}
\definecolor{grayish}{rgb}{.9, .9, .9}

\definecolor{g11}{rgb}{0, 0, 1}
\definecolor{g12}{rgb}{0, .4, 1}
\definecolor{g13}{rgb}{0, .8, 1}

\definecolor{g21}{rgb}{0, .5, .3}
\definecolor{g22}{rgb}{.4, .5, .3}
\definecolor{g23}{rgb}{.8, .5, .3}

\definecolor{dkgreen}{rgb}{0,0.6,0}
\definecolor{mauve}{rgb}{0.58,0,0.82}

\definecolor{p0}{RGB}{150,0,0}
\definecolor{p1}{RGB}{0,150,0}
\definecolor{p2}{RGB}{0,0,150}
\definecolor{p3}{RGB}{150,75,0}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%% lstlisting
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\usepackage{listings}
\usepackage{ifpdf}

\lstdefinelanguage{sh}{basicstyle=\ttfamily\color{white}, backgroundcolor=\color{black}, breaklines=true} 

\ifpdf
\lstdefinelanguage{rr}{language=R, 
                      basicstyle=\ttfamily\color{black}, 
		      backgroundcolor=\color{grayish}, 
		      frame=single, 
		      breaklines=true, 
                      keywordstyle=\color{blue},
		      commentstyle=\color{dkgreen},
		      stringstyle=\color{mauve},
		      numbers=left,%none,
		      numberstyle=\tiny\color{dkgray},
		      stepnumber=1,       
		      numbersep=8pt,      
		      showspaces=false,      
		      showstringspaces=false,  
		      showtabs=false,     
		      rulecolor=\color{gray},   
		      tabsize=4,     
		      captionpos=t,
		      title=\lstname,
		      escapechar=?
% 		      escapeinside={(*@}{@*)},
% 		      escapebegin={\begin{lrbox}{0}\minipage[t]{.3\linewidth}\raggedleft\normalfont\itshape\small\leavevmode\color{black!70}\ignorespaces},
%                       escapeend={\endminipage\end{lrbox}\llap{\raisebox{0pt}[0pt][0pt]{\box0}\hspace{\comsep}}}
} 

\else

\lstdefinelanguage{rr}{basicstyle=\ttfamily\color{black}, 
		       backgroundcolor=\color{grayish}, 
		       frame=single, 
		       breaklines=true, 
		       tabsize=2
%                       keywordstyle=\color{blue},
% 		      commentstyle=\color{dkgreen},
% 		      stringstyle=\color{mauve}
} 

\fi


\lstnewenvironment{rr}{%
  \lstset{%
     language = R,%
      style    = default,%
    }%
 }{}





% \lstdefinelanguage{ft}{
%   language=[90]Fortran,
%   basicstyle=\ttfamily,
%                       keywordstyle=\color{blue},
% 		      commentstyle=\color{dkgreen},
%   morecomment=[l]{!\ }
% }



% \lstset{numbers=none,numberstyle=\footnotesize\ttfamily,
%         frame=single,frameround=tttt,language=R,
%         showspaces=false,showstringspaces=false,
%         breaklines=true,breakatwhitespace=true,
%         basicstyle=\small\ttfamily}
%\lstset{literate={<-}{{$\leftarrow$}}1}
% \makeatletter
% \let\Code\@undefined
% \let\CodeInput\@undefined
% \let\CodeOutput\@undefined
% \makeatother
% \lstnewenvironment{Command}[1][title=Shell Command]{\lstset{#1}}{}
% \lstnewenvironment{Code}[1][title=R Script]{\lstset{#1}}{}
% \lstnewenvironment{CodeOutput}[1][title=R Output]{\lstset{#1}}{}
% \lstnewenvironment{Error}[1][]{
%   \lstset{title=Error Message,basicstyle=\small\ttfamily}\color{Red}}{}
  

\makeatletter
\let\Code\@undefined
\let\CodeInput\@undefined
\let\CodeOutput\@undefined
\makeatother
\lstnewenvironment{Command}[1][]{\lstset{#1}}{}
\lstnewenvironment{Code}[1][]{\lstset{#1}}{}
\lstnewenvironment{CodeOutput}[1][]{\lstset{#1}}{}
\lstnewenvironment{Error}[1][]{
  \lstset{title=Error Message,basicstyle=\small\ttfamily}\color{Red}}{}
  
  
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%% Chapter headings
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% \usepackage[Bjornstrup]{fncychap}
% \usepackage[Lenny]{fncychap}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%% Headers/footers
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\usepackage{lastpage}
\usepackage{fancyhdr}

\pagestyle{fancy}

\newcommand{\prebodyheadfoot}{
  \fancyhf{} % clear all header and footer fields
  \fancyfoot{}
  \renewcommand{\headrulewidth}{0pt}
  \renewcommand{\footrulewidth}{0pt}
  
  % redefinition of the plain style:
  \fancypagestyle{plain}{%
  \fancyhf{} % clear all header and footer fields
  \renewcommand{\headrulewidth}{0pt}
  \renewcommand{\footrulewidth}{0pt}}
}

\newcommand{\bodyheadfoot}{
  \fancyhf{} % clear all header and footer fields
%   \fancyhead[L]{\slshape \rightmark}
  \fancyhead[L]{\slshape \leftmark}
  \fancyhead[R]{ \thepage\ of\ \pageref{LastPage}}
  \fancyfoot[C]{\hrule Version \printversion}
  \renewcommand{\headrulewidth}{1pt}
  \renewcommand{\footrulewidth}{0pt}
  
  % redefinition of the plain style:
  \fancypagestyle{plain}{%
  \fancyhf{} % clear all header and footer fields
  \renewcommand{\headrulewidth}{0pt}
  \renewcommand{\footrulewidth}{0pt}}
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%% Fancy toc originally from http://tex.stackexchange.com/questions/35825/pretty-table-of-contents?lq=1
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\usepackage{xcolor}
\usepackage{framed}
\usepackage{tikz}
\usepackage{titletoc}
\usepackage{etoolbox}
\usepackage{lmodern}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%% misc.
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% \usepackage{url}
\usepackage{amsmath}
\usepackage{amsthm}
\usepackage{amssymb}
% \usepackage{subfig}


\usepackage{hyperref}

\hypersetup{
    pdfnewwindow=true,    
    colorlinks=true,      
    linkcolor=blue,      
    citecolor=blue,      
    filecolor=magenta,   
    urlcolor=blue      
}

\usepackage[absolute]{textpos}

